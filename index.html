<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Optimized CMU Polygon Player</title>
  <style>
    body { display:flex; flex-direction:column; align-items:center; gap:12px; margin:0; padding:16px; background:#f5f5f5; font-family:system-ui, sans-serif; }
    #row { display:flex; gap:20px; align-items:flex-start; }
    #canvas { border:1px solid #000; background:#fff; }
    #controls { display:flex; flex-direction:column; gap:8px; }
    #output { white-space:pre-wrap; font-family:monospace; width:600px; height:300px; padding:8px; border:1px solid #ccc; background:#fafafa; }
    label { display:flex; align-items:center; gap:6px; }
    input[type="range"] { width:240px; }
    button { padding:8px 12px; cursor:pointer; }
    .note { font-size:12px; color:#444; }
  </style>
</head>
<body>
  <h1>Optimized CMU Polygon Code Generator</h1>

  <div id="row">
    <canvas id="canvas" width="400" height="400"></canvas>
    <div id="controls">
      <label>
        <input type="checkbox" id="mono-toggle" checked />
        Mono Mode (white bg + black polygon morph)
      </label>
      <label>
        <input type="checkbox" id="color-toggle" />
        Color Mode (full polygons each frame)
      </label>
      <button id="play">â–¶ Play Animation</button>
      <textarea id="output" readonly></textarea>
      <button id="copy">Copy Code</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const outputEl = document.getElementById('output');

    // ðŸ”¹ REPLACE THESE ARRAYS WITH YOUR ACTUAL DATA ðŸ”¹
    const framesMono = [
      // Example: [x1,y1, x2,y2, ..., xN,yN]
      // Insert your real mono black polygon frames here
    ];

    const framesColor = [
      // Example: [ {points:[...], fill:"rgb(r,g,b)"}, {...} ]
      // Insert your real color frames here
    ];
    // ðŸ”¹ END PLACEHOLDER ðŸ”¹

    // Normalize mono frames to equal vertex count
    function normalizeMonoFrames(frames) {
      let maxPts = 0;
      frames.forEach(f => { if (f.length/2 > maxPts) maxPts = f.length/2; });
      return frames.map(f => {
        const pts = f.slice();
        while (pts.length/2 < maxPts) {
          pts.push(pts[pts.length-2], pts[pts.length-1]); // duplicate last point
        }
        return pts;
      });
    }

    const normMonoFrames = normalizeMonoFrames(framesMono);

    function polygonsToCodeMono(frames) {
      let code = "w = Polygon(0,0,"+canvas.width+",0,"+canvas.width+","+canvas.height+",0,"+canvas.height+",0,0, fill='white')\n";
      code += "b = Polygon("+frames[0].join(",")+", fill='black')\n";
      frames.forEach((frame, fi) => {
        frame.forEach((val, i) => {
          const axis = (i % 2 === 0) ? "x" : "y";
          const idx = Math.floor(i/2)+1;
          code += `b.${axis}${idx} = ${val}\n`;
        });
        code += "sleep(0.04)\n";
      });
      return code;
    }

    function polygonsToCodeColor(frames) {
      let code = "";
      frames.forEach(polys => {
        polys.forEach(poly => {
          code += "Polygon(" + poly.points.join(",") + ", fill='" + poly.fill + "')\n";
        });
        code += "sleep(0.04)\n";
      });
      return code;
    }

    function renderFrameMono(points) {
      ctx.fillStyle = "white";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.beginPath();
      ctx.moveTo(points[0], points[1]);
      for (let i=2;i<points.length;i+=2) ctx.lineTo(points[i], points[i+1]);
      ctx.closePath();
      ctx.fillStyle = "black";
      ctx.fill();
    }

    function renderFrameColor(polys) {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      polys.forEach(poly => {
        ctx.beginPath();
        ctx.moveTo(poly.points[0], poly.points[1]);
        for (let i=2;i<poly.points.length;i+=2) ctx.lineTo(poly.points[i], poly.points[i+1]);
        ctx.closePath();
        ctx.fillStyle = poly.fill;
        ctx.fill();
      });
    }

    document.getElementById('play').addEventListener('click', async () => {
      const mono = document.getElementById('mono-toggle').checked;
      const color = document.getElementById('color-toggle').checked;

      if (mono && normMonoFrames.length) {
        outputEl.value = polygonsToCodeMono(normMonoFrames);
        for (let f of normMonoFrames) {
          renderFrameMono(f);
          await new Promise(r=>setTimeout(r,40));
        }
      } else if (color && framesColor.length) {
        outputEl.value = polygonsToCodeColor(framesColor);
        for (let f of framesColor) {
          renderFrameColor(f);
          await new Promise(r=>setTimeout(r,40));
        }
      } else {
        alert("No frames loaded!");
      }
    });

    document.getElementById('copy').addEventListener('click', () => {
      outputEl.select(); document.execCommand('copy'); alert('Code copied!');
    });
  </script>
</body>
</html>
